---
title: CSAPP之链接
tags:
  - CSAPP
toc: true
date: 2017-11-09 21:25:54
---
# 前言
链接就是将代码和数据组合成一个单一文件的过程，组成的文件可以被加载到内存并执行。链接可以执行于编译时，也可以执行于加载时，甚至执行于运行时。链接在软件开发中扮演着一个关键的角色，因为它使得分离编译成为可能，我们可以将一个大型的应用程序分解为更小更好管理的模块，并且独立的修改和编译这些模块，当我们修改这些模块中的一个时只需要重新编译它，并重新链接应用，而不必重新编译其他文件。

# 编译器驱动程序
在将源代码编译成可执行程序时，会经历如下步骤：首先，运行预处理器将源程序翻译成一个ASCII码的中间文件；然后，运行C编译器将中间文件翻译成一个汇编文件；再运行汇编器将汇编文件翻译成可重定位目标文件；最后，运行链接程序将可重定位目标文件以及一些必要的系统目标文件组合起来，创建一个可执行目标文件。
``` bash
cpp sum.c /tmp/sum.i #预处理
/usr/lib/gcc/x86_64-linux-gnu/5/cc1 /tmp/sum.i -Og -o /tmp/sum.s #编译
as -o /tmp/sum.o /tmp/sum.s #汇编
ld -o prog /tmp/main.o /tmp/sum.o #链接
```
<!--more-->
<center>![avatar](http://oyh38rhr2.bkt.clouddn.com/github/171109/A04eBDGA1j.jpg)</center>

# 静态链接
链接器的主要任务：
符号解析。符号解析就是将每个符号引用和一个符号定义关联起来
重定位。编译器和汇编器生成从地址0开始的代码和数据节，链接器通过把每个符号定义与一个内存位置关联起来，从而重定位这些节，然后修改所有对这些符号的引用，使得它们指向这个内存位置。

# 可重定位目标文件
.bss节：未初始化的全局变量，和静态变量以及所有被初始化为0的全局或静态变量。在目标文件中这个节不占实际空间，它仅仅是一个占位符。目标文件格式区分已初始化和未初始化变量是为了空间效率：在目标文件中，未初始化变量，不需要占用任何实际的磁盘空间。运行时在内存中分配这些变量，初始值为0。所以，一种区分.data和.bss节的简单方式就是把`bss`看成是“更好地节省空间(Better Save Sapce)”的缩写。可重定位目标文件格式如下：
<center>![avatar](http://oyh38rhr2.bkt.clouddn.com/github/171109/ia5cF7fIGk.jpg)</center>
